# RSシステム データ可視化プロジェクト

RSシステム（行政事業レビュー見える化サイト）のデータをダウンロード・処理・可視化するためのPythonプロジェクトです。

## セットアップ

### 1. 仮想環境の作成と有効化

```bash
# 仮想環境を作成
python3 -m venv venv

# 仮想環境を有効化（Linux/Mac）
source venv/bin/activate

# 仮想環境を有効化（Windows）
venv\Scripts\activate
```

### 2. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

## 使い方

### 手動ダウンロード方式（推奨）

RSシステムのデータは手動でダウンロードする必要があります。

1. [RSシステム](https://rssystem.go.jp)にアクセス
2. データダウンロードページから必要なZIPファイルをダウンロード
3. `downloads`ディレクトリを作成し、ダウンロードしたZIPファイルを配置

```bash
mkdir downloads
# ダウンロードしたZIPファイルをdownloadsフォルダに配置
```

4. データ処理スクリプトを実行

```bash
python scripts/process_local_data.py
```

### 自動ダウンロード試行（制限あり）

```bash
python scripts/fetch_rs_data.py
```

注意: SPA構造により直接HTTP取得は制限されています。手動ダウンロードが確実です。

## プロジェクト構造

```
rs-visualization/
├── scripts/
│   ├── fetch_rs_data.py      # 自動ダウンロードスクリプト（実験的）
│   └── process_local_data.py # ローカルデータ処理スクリプト
├── downloads/                 # 手動でダウンロードしたZIPファイル配置用
├── data/
│   ├── raw/                  # ダウンロードした生データ
│   ├── extracted/             # 解凍されたデータ
│   ├── processed/             # 処理済みデータ
│   └── reports/               # 分析レポート
├── requirements.txt           # Python依存パッケージ
├── .gitignore                # Git除外設定
└── README.md                 # このファイル
```

## 機能

- **手動データ処理**: RSシステムから手動ダウンロードしたファイルの処理
- **ZIP解凍**: ダウンロードしたZIPファイルの自動解凍
- **データ分析**: CSV/Excelファイルの構造分析
  - カラム情報・データ型・欠損値の確認
  - 統計情報・メモリ使用量・日本語エンコーディング自動検出
- **データマージ**: 複数のCSVファイルの結合
  - 縦結合（concatenation）: 全詳細レコード保持
  - 横結合（merge）: 予算事業ID・年度による正規化
- **レポート生成**: JSON・HTML形式の分析レポート

## 処理結果（2024年度実績）

### データセット概要
- **処理ファイル数**: 15 ZIPファイル
- **データカテゴリ**: 基本情報・予算執行・効果発現・支出先・評価
- **エンコーディング**: UTF-8（自動検出・変換）

### マージ方式別レコード数

| 方式 | レコード数 | 用途 |
|------|------------|------|
| **縦結合** | **553,094行** | 全詳細データの保持・分析 |
| **事業単位統合** | **5,664行** | 事業中心の統合ビュー |

※ 5,664は2024年度の実際の予算事業数と一致

## 出力ファイル

### 処理結果
- `data/reports/analysis_report.json`: 詳細な分析結果（15ファイルの構造情報）
- `data/reports/analysis_report.html`: 視覚的な分析レポート  
- `data/processed/merged_data.csv`: マージされたデータ（553,094行、251列）
- `downloads/`: 手動ダウンロードしたZIPファイルの配置場所

## トラブルシューティング

### エンコーディングエラー

日本語データのエンコーディング問題が発生した場合、スクリプトは自動的に以下のエンコーディングを試行します：
- UTF-8
- Shift-JIS
- CP932
- UTF-8 with BOM
- ISO-2022-JP

### メモリ不足

大規模なデータセットを処理する際にメモリ不足が発生する場合：
1. データを分割して処理
2. `chunksize`パラメータを使用した段階的読み込み

## 実績と検証

### 2024年度データ処理実績（手動ダウンロード）
- ✅ RSシステムから15 ZIPファイル（1.2GB）を手動取得
- ✅ 553,094レコードの詳細データ統合
- ✅ 5,664ユニーク事業の正規化（公式数値と一致）  
- ✅ 日本語エンコーディング自動処理（UTF-8変換）
- ✅ 5カテゴリ全データファイルの完全処理

### パフォーマンス
- 処理時間: 約3-5分（手動方式）
- メモリ使用量: 約500MB（ピーク時）
- 出力サイズ: 約150MB（統合CSV）

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

バグ報告や機能提案は、GitHubのIssuesページでお願いします。